= content_for :css do
  = stylesheet_link_tag "chocoholic/application"

%ul.breadcrumb
  %li
    %i.icon-folder-open
  - @directory.ancestors.each do |a|
    %li
      = link_to a.name, {:id => a.id }
      %span.divider= "/"
  %li.active= @directory.name

.row
  .span3
    .panel.rounded.visible-desktop
      .content
        - directory = @directory
        %ul.nav.nav-list
          %li.nav-header 操作
          %li
            = link_to edit_content_path(directory) do
              %i.icon-info-sign
              = "詳細"
          - unless directory.is_root?
            %li.divider
            %li
              = link_to({:action => :destroy}, :method => :delete, :confirm => "Are you sure?") do
                %i.icon-trash
                = "削除"
  .span9
    .panel.rounded
      .header.rounded-top
        %h4
          %i.icon-folder-open
          = @directory.name

      .content
        = simple_nested_form_for @directory.becomes_content do |f|
          = f.input :name
          #user_permission_area
            %table.table.table-striped.nested_form
              %tr
                %th= "ユーザー"
                %th= "権限"
                %th.action
              = f.fields_for :user_permissions, :wrapper => false do |pf|
                %tr.fields
                  %td
                    - if pf.object.new_record?
                      = pf.input :resource_object_id, {:as => :select, :collection => target_company.users, :value_method => :id, :label_method => :name, :include_blank => true, :selected => pf.object.resource_id.to_s, :label => false}
                    - else
                      %label= pf.object.resource.name
                    = pf.input :resource_type_name, :as => :hidden, :input_html => { :value => "user" }
                  %td
                    = pf.input :mode, {:as => :select, :collection => [["readonly", "閲覧のみ"], ["writable", "書き込み可能"]], :value_method => :first, :label_method => :last, :selected => pf.object.mode, :label => false}
                  %td= pf.link_to_remove '', {:class => 'icon-remove-sign'}
              %tr
                %td
                %td
                %td= f.link_to_add '', :user_permissions, {:class => 'icon-plus-sign'}

          %table.table.table-striped.nested_form
            %tr
              %th= "グループ"
              %th= "権限"
              %th.action
            = f.fields_for :category_item_user_permissions, wrapper: false do |pf|
              %tr.fields
                %td
                  = pf.collection_select :resource_object_id, target_company.user_categories.map { |uc| uc.items }.flatten, :id, :name_with_category, {:include_blank => true, :selected => pf.object.resource_id.to_s}
                  = pf.hidden_field :resource_type_name, :value => "category_item"
                %td
                  = pf.collection_select :mode, [["readonly", "閲覧のみ"] ,["writable", '書き込み可能']], :first, :last, {:selected => pf.object.mode}
                %td= pf.link_to_remove '', {:class => 'icon-remove-sign'}
            %tr
              %td
              %td
              %td= f.link_to_add '', :category_item_user_permissions, {:class => 'icon-plus-sign'}
          = f.button :submit
